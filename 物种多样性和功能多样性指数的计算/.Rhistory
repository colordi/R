install.packages(c("FD", "vegan"))
#计算物种多样性的函数
species_diversity <- function(data,output=FALSE){
library(vegan) #导入vegan多样性计算包
data[is.na(data)] <- 0 #把数据中的所有缺失值补成0
abundance <- apply(data,1,sum) #计算所有样地的多度
richness <- rowSums(data > 0) #计算所有样地的物种丰富度*
shannon_index <- diversity(data, index = 'shannon', base = exp(1))#计算Shannon指数*
shannon_diversity <- exp(1)^shannon_index#Shannon多样性
pielou <- shannon_index / log(richness, exp(1))#Pielou均匀度*
gini_simpson_index <- diversity(data, index = 'simpson')#Simpson指数
simpson_diversity <- 1 / (1 - gini_simpson_index)#Simpson多样性
equitability <- 1 / (richness * (1 - gini_simpson_index))#Simpson均匀度
chao1 <- estimateR(data)[2, ]#chao1指数
ace <- estimateR(data)[4, ]#ACE指数
goods_coverage <- 1 - rowSums(data == 1) / rowSums(data)#goods_coverage指数
#把结果保存在output对象中
result <- data.frame(abundance,richness,shannon_index,shannon_diversity,pielou,
gini_simpson_index,simpson_diversity,equitability,
chao1,ace,goods_coverage,row.names = row.names(data))
if (output== TRUE){write.xlsx(result,file="多样性指数.xlsx")}
return(result)
}
#计算功能多样性的函数
function_diversity <- function(abdundance,trait,output = FALSE){
library(FD)#功能多样性分析包
#蚂蚁多度数据转换
abundance[is.na(abundance)] <- 0#把多度数据中的缺失值用0替换
abundance <- data.matrix(abundance)#把多度数据转换为矩阵
index <- dbFD(trait,abundance)# 计算指数
result <- data.frame(index$FRic,
index$FEve,
index$FDiv,
index$FDis,
index$RaoQ
)
if (output == TRUE) {write.xlsx(result,file = '功能多样性指数.xlsx',rowNames=T)}
}
library(openxlsx)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（未转换）.xlsx')
View(data)
View(data)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（未转换）.xlsx',rowNames = T)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（未转换）.xlsx',rowNames = TRUE)
rm(data)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（未转换）.xlsx',rowNames = TRUE)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（未转换）.xlsx')
species_diversity(data)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（6级转换）.xlsx')
View(data)
?apply(array, margin, ...)
View(data)
data <- read.xlsx('/Users/yandi/Documents/PROFESSONAL/100-MasterPaper/130-数据存档/蚂蚁多样性/多样性指数_分析_牟定蚂蚁数据（6级转换）.xlsx',rowNames = T)
View(data)
species_diversity(data)
result <- species_diversity(data)
View(result)
source('deversity.R')
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source('deversity.R')
source('diversity.R')
getwd()
setwd('yandi')
setwd('/yandi')
setwd('/')
getwd()
source('diversity.R')
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source('diversity.R')
library(openxlsx)
data <- read.xlsx('多样性数据.xlsx',rowNames = T)
View(species_diversity)
source('diversity.R')
library(openxlsx)
data <- read.xlsx('多样性数据.xlsx',rowNames = T)
species_diversity(data,output = T)
result <- species_diversity(data,output = F)
View(result)
?write.xlsx
source('diversity.R')
library(openxlsx)
data <- read.xlsx('多样性数据.xlsx',rowNames = T)
result <- species_diversity(data,output = T)
?read.xlsx
abundance <- read.xlsx('功能多样性数据.xlsx',sheet = 1)#读取第1个sheet表
View(abundance)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source('diversity.R')
#读取第1个sheet表
abundance <- read.xlsx('功能多样性数据.xlsx',sheet = 1, rowNames = T)
#读取第2个sheet表
trait <- read.xlsx('功能多样性数据.xlsx',sheet = 2, rowNames = T)
result <- function_diversity(abundance,trait,output = F)
source('diversity.R')
#读取第1个sheet表
abundance <- read.xlsx('功能多样性数据.xlsx',sheet = 1, rowNames = T)
#读取第2个sheet表
trait <- read.xlsx('功能多样性数据.xlsx',sheet = 2, rowNames = T)
result <- function_diversity(abundance,trait,output = F)
View(result)
